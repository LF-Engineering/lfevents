window.wp=window.wp||{},window.wpmlc=window.wpmlc||{l10n:{}},function(e,t){var i=wp.media,r=i.view.l10n,l=i.view.settings.mediaTrash,o={};t.extend(wpmlc.l10n,wpmlcp_media_views_l10n),t.defaults(wpmlc.l10n,{media_orderby:"date",media_order:"DESC"}),o.controllerLibrary={activate:i.controller.Library.prototype.activate},t.extend(i.controller.Library.prototype.defaults,{idealColumnWidth:e(window).width()<640?120:135}),t.extend(i.controller.Library.prototype,{activate:function(){o.controllerLibrary.activate.apply(this,arguments),wp.Uploader.queue.on("add",this.beforeUpload,this),wp.Uploader.queue.on("reset",this.afterUpload,this)},beforeUpload:function(){1==wp.Uploader.queue.length&&e('.attachment-filters:has(option[value!="all"]:selected)').val("all").change()},afterUpload:function(){var e=this.get("library"),t=this.get("selection");"menuOrder"===e.props.get("orderby")&&e.saveMenuOrder(),e.reset(e.models),t.trigger("selection:unsingle",t.model,t),t.trigger("selection:single",t.model,t)},uploading:function(e){var t=this.frame.content,i=this.get("selection");"upload"===t.mode()&&this.frame.content.mode("browse"),this.get("autoSelect")&&(1==wp.Uploader.queue.length&&i.length&&i.reset(),i.add(e),i.trigger("selection:unsingle",i.model,i),i.trigger("selection:single",i.model,i))}}),t.extend(i.view.AttachmentCompat.prototype,{save:function(i){var r,l={};i&&i.preventDefault(),this.controller.isModeActive("wpmlc-grid")&&(r=this.controller.browserView.toolbar.get("spinner")),t.each(this.$el.serializeArray(),function(e){l[e.name]=e.value}),e("input",this.$el).prop("disabled",!0),r&&r.show(),this.noRender=!0,this.controller.trigger("attachment:compat:waiting",["waiting"]),this.model.saveCompat(l).done(t.bind(this.postSave,this,1)).fail(t.bind(this.postSave,this,0))},postSave:function(t){var i,r,l;"edit-attachment"!==this.controller._state&&(i=this.controller.toolbar.get()),this.controller.isModeActive("wpmlc-grid")&&(r=this.controller.browserView.toolbar.get("spinner")),e("input",this.$el).prop("disabled",!1),r&&r.hide(),i&&((l=t?i.get("wpmlcAttachmentSuccess"):i.get("wpmlcAttachmentError")).$el.fadeIn(200),setTimeout(function(){l.$el.fadeOut(100)},800)),this.controller.trigger("attachment:compat:ready",["ready"])},render:function(){var i=this.model.get("compat"),r=(this.$el,this.model.get("tcount"));if(t.each(r,function(t,i){var r=e('.wpmlc-taxonomy-filters option[value="'+i+'"]'),l=r.text();l=l.replace(/\(.*?\)/,"("+t+")"),r.text(l)}),i&&i.item)return this.noRender?this:(this.views.detach(),this.$el.html(i.item),this.views.render(),this)}}),t.extend(i.view.AttachmentFilters.prototype,{change:function(){var i=this.filters[this.el.value],r=this.controller.state().get("selection"),o=this.controller.content.get().toolbar.get("resetFilterButton"),s=e(".attachment-filters").length,n=e(".attachment-filters").map(function(){return this.value}).get().filter(function(e){return"all"===e}).length;i&&this.model.set(i.props),i&&r&&r.length&&1!==wp.Uploader.queue.length&&r.reset(),i&&l&&!t.isUndefined(this.controller.toolbar)&&this.controller.toolbar.get().$(".media-selection").toggleClass("trash","trash"===i.props.status),t.isUndefined(o)||o.model.set("disabled",s===n)},select:function(){var e=this.model,i="all",r=e.toJSON();r=t.omit(r,"orderby","order"),t.find(this.filters,function(e,l){var o=t.omit(e.props,"orderby","order");if(t.all(o,function(e,i){return e===(t.isUndefined(r[i])?null:r[i])}))return i=l}),this.$el.val(i)}}),o.AttachmentFilters={All:{createFilters:i.view.AttachmentFilters.All.prototype.createFilters},Uploaded:{createFilters:i.view.AttachmentFilters.Uploaded.prototype.createFilters}},t.extend(i.view.AttachmentFilters.All.prototype,{createFilters:function(){var e,i=t.intersection(t.keys(wpmlc.l10n.taxonomies),wpmlc.l10n.filter_taxonomies);o.AttachmentFilters.All.createFilters.apply(this,arguments),t.each(this.filters,function(e,t){e.props.uncategorized=null,e.props.orderby=wpmlc.l10n.media_orderby,e.props.order=wpmlc.l10n.media_order}),this.filters.uncategorized={text:wpmlc.l10n.uncategorized,props:{uploadedTo:null,uncategorized:!0,status:null,type:null,orderby:wpmlc.l10n.media_orderby,order:wpmlc.l10n.media_order},priority:60},e=this.filters.uncategorized.props,t.each(i,function(t){e[t]=null}),l&&(this.controller.isModeActive("grid")||this.controller.isModeActive("wpmlc-grid"))&&(this.filters.trash={text:r.trash,props:{uploadedTo:null,status:"trash",type:null,orderby:"date",order:"DESC"},priority:70})}}),t.extend(i.view.AttachmentFilters.Uploaded.prototype,{createFilters:function(){t.intersection(t.keys(wpmlc.l10n.taxonomies),wpmlc.l10n.filter_taxonomies);o.AttachmentFilters.Uploaded.createFilters.apply(this,arguments),t.each(this.filters,function(e,t){e.props.orderby=wpmlc.l10n.media_orderby,e.props.order=wpmlc.l10n.media_order})}}),i.view.AttachmentFilters.Taxonomy=i.view.AttachmentFilters.extend({id:function(){return"media-attachment-"+this.options.taxonomy+"-filters"},className:function(){return"attachment-filters wpmlc-taxonomy-filters attachment-"+this.options.taxonomy+"-filter"},createFilters:function(){var i={},r=this;t.each(r.options.termList||{},function(t,l){var o=t.term_id,s=e("<div/>").html(t.term_row).text();i[o]={text:s,props:{uncategorized:null,orderby:wpmlc.l10n.media_orderby,order:wpmlc.l10n.media_order},priority:l+4},i[o].props[r.options.taxonomy]=o}),i.all={text:wpmlc.l10n.filter_by,props:{uncategorized:null,orderby:wpmlc.l10n.media_orderby,order:wpmlc.l10n.media_order},priority:1},i.all.props[r.options.taxonomy]=null,this.filters=i}}),i.view.AttachmentFilters.Authors=i.view.AttachmentFilters.extend({createFilters:function(){var e={};t.each(this.options.users||{},function(t,i){var r=t.user_id,l=t.user_name;e[r]={text:l,props:{author:r,orderby:wpmlc.l10n.media_orderby,order:wpmlc.l10n.media_order},priority:i+2}}),e.all={text:wpmlc.l10n.in+" "+wpmlc.l10n.authors,props:{author:null,orderby:wpmlc.l10n.media_orderby,order:wpmlc.l10n.media_order},priority:1},this.filters=e}}),i.view.Button.resetFilters=i.view.Button.extend({id:"reset-all-filters",initialize:function(){i.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("select:activate select:deactivate",this.toogleResetFilters,this)},click:function(t){"#"===this.attributes.href&&t.preventDefault(),e('.attachment-filters:has(option[value!="all"]:selected)').each(function(t){e(this).val("all").change()})},toogleResetFilters:function(){this.$el.toggleClass("hidden")}}),i.view.wpmlcAttachmentDetailsEditMessage=i.View.extend({tagName:"div",id:"wpmlc-save-changes-message",initialize:function(){this.text=this.options.text,this.class=this.options.class},render:function(){return this.$el.addClass(this.class),this.$el.html("<p><strong>"+this.text+"</strong></p>"),this}}),t.extend(i.view.Attachment.Details.prototype,{deleteAttachment:function(e){e.preventDefault(),window.confirm(r.warnDelete)&&(this.model.destroy(),this.controller.modal&&this.controller.modal.focusManager.focus())}}),o.AttachmentsBrowser={initialize:i.view.AttachmentsBrowser.prototype.initialize,createToolbar:i.view.AttachmentsBrowser.prototype.createToolbar,createSidebar:i.view.AttachmentsBrowser.prototype.createSidebar,createSingle:i.view.AttachmentsBrowser.prototype.createSingle,disposeSingle:i.view.AttachmentsBrowser.prototype.disposeSingle},t.extend(i.view.AttachmentsBrowser.prototype,{initialize:function(){o.AttachmentsBrowser.initialize.apply(this,arguments),this.on("ready",this.fixLayout,this),this.$window=e(window),this.$window.on("resize",t.debounce(t.bind(this.fixLayout,this),15)),e(".notice-dismiss").length&&e(document).on("click",".notice-dismiss",t.debounce(t.bind(this.fixLayout,this),250))},fixLayout:function(){var i=this.$el,r=i.find(".attachments"),l=i.find(".uploader-inline"),o=i.find(".media-toolbar"),s=e(".wpmlc-media-css .updated:visible, .wpmlc-media-css .error:visible, .wpmlc-media-css .notice:visible, .wpmlc-media-css .notice-error:visible, .wpmlc-media-css .notice-warning:visible, .wpmlc-media-css .notice-success:visible, .wpmlc-media-css .notice-info:visible"),n=e(".wpmlc-media-css .update-nag");if(n.length&&(n.css("margin-left","15px"),i.closest(".wrap").css("top",n.outerHeight()+25+"px")),(this.controller.isModeActive("select")||this.controller.isModeActive("wpmlc-grid"))&&(this.controller.isModeActive("select")&&(r.css("top",o.height()+10+"px"),l.css("top",o.height()+10+"px"),i.find(".wpmlc-loader").css("top",o.height()+10+"px"),o.find(".media-toolbar-secondary").prepend(o.find(".instructions"))),this.controller.isModeActive("wpmlc-grid"))){var a=0;t.isUndefined(s)||(s.each(function(){a+=e(this).outerHeight(!0)}),a=a?a-15:0),i.css("top",o.outerHeight()+a+15+"px"),o.css("top",-o.outerHeight()-25+"px")}},createToolbar:function(){var o,s,n,a=this,c=1;if(n={controller:this.controller},(this.controller.isModeActive("grid")||this.controller.isModeActive("wpmlc-grid"))&&(n.className="media-toolbar wp-filter"),this.toolbar=new i.view.Toolbar(n),this.views.add(this.toolbar),this.toolbar.set("spinner",new i.view.Spinner({priority:-40})),(this.controller.isModeActive("grid")||this.controller.isModeActive("wpmlc-grid"))&&(o=i.View.extend({className:"view-switch media-grid-view-switch",template:i.template("media-library-view-switcher")}),this.toolbar.set("libraryViewSwitcher",new o({controller:this.controller,priority:-90}).render())),(-1!==e.inArray(this.options.filters,["uploaded","all"])||parseInt(wpmlc.l10n.force_filters)&&!this.controller.isModeActive("wpmlc-bulk-edit")&&"gallery-edit"!==this.controller._state&&"playlist-edit"!==this.controller._state&&"video-playlist-edit"!==this.controller._state||"customize"===wpmlc.l10n.current_screen||"widgets"===wpmlc.l10n.current_screen)&&(wpmlc.l10n.wp_version>="5.3"&&this.toolbar.set("filters-heading",new wp.media.view.Heading({priority:-100,text:r.filterAttachments,level:"h2",className:"media-attachments-filter-heading"}).render()),-1!==e.inArray("types",wpmlc.l10n.filters_to_show)&&(this.toolbar.set("filtersLabel",new i.view.Label({value:r.filterByType,attributes:{for:"media-attachment-filters"},priority:-80}).render()),"uploaded"===this.options.filters?this.toolbar.set("filters",new i.view.AttachmentFilters.Uploaded({controller:this.controller,model:this.collection.props,priority:-80}).render()):(s=new i.view.AttachmentFilters.All({controller:this.controller,model:this.collection.props,priority:-80}),this.toolbar.set("filters",s.render()))),wpmlc.l10n.wp_version>="4.0"&&-1!==e.inArray("dates",wpmlc.l10n.filters_to_show)&&i.view.settings.months.length&&(this.toolbar.set("dateFilterLabel",new i.view.Label({value:r.filterByDate,attributes:{for:"media-attachment-date-filters"},priority:-75}).render()),this.toolbar.set("dateFilter",new i.view.DateFilter({controller:this.controller,model:this.collection.props,priority:-75}).render())),wpmlc.l10n.users.length>1&&-1!==e.inArray("authors",wpmlc.l10n.filters_to_show)&&(this.toolbar.set("authorFilterLabel",new i.view.Label({value:wpmlc.l10n.filter_by+" "+wpmlc.l10n.author,attributes:{for:"author-filter"},priority:c++-70}).render()),this.toolbar.set("author-filter",new i.view.AttachmentFilters.Authors({controller:this.controller,model:this.collection.props,priority:c++-70,users:wpmlc.l10n.users}).render())),-1!==e.inArray("taxonomies",wpmlc.l10n.filters_to_show)&&e.each(wpmlc.l10n.taxonomies,function(e,r){-1!==t.indexOf(wpmlc.l10n.filter_taxonomies,e)&&r.term_list.length&&(a.toolbar.set(e+"FilterLabel",new i.view.Label({value:wpmlc.l10n.filter_by,attributes:{for:"media-attachment-"+e+"-filters"},priority:c++-70}).render()),a.toolbar.set(e+"-filter",new i.view.AttachmentFilters.Taxonomy({controller:a.controller,model:a.collection.props,priority:c++-70,taxonomy:e,termList:r.term_list}).render()))}),this.toolbar.$el.find(".attachment-filters").length>1&&this.toolbar.set("resetFilterButton",new i.view.Button.resetFilters({controller:this.controller,text:wpmlc.l10n.reset_filters,disabled:!0,priority:c++-70}).render())),this.controller.isModeActive("wpmlc-grid")){var d=this.controller.toolbar.get();e("body").hasClass("wpmlc-pro-media-css")&&d.set("wpmlcSelectAllButton",new i.view.wpmlcSelectAllButton({filters:s,disabled:!0,text:wpmlc.l10n.select_all,controller:this.controller,priority:-80}).render()),d.set("wpmlcDeselectButton",new i.view.wpmlcDeselectButton({filters:s,disabled:!0,text:r.cancelSelection,controller:this.controller,priority:-70}).render()),d.set("wpmlcDeleteSelectedButton",new i.view.wpmlcDeleteSelectedButton({filters:s,style:"primary",disabled:!0,text:l?r.trashSelected:r.deleteSelected,controller:this.controller,priority:-60}).render()),l&&d.set("wpmlcDeleteSelectedPermanentlyButton",new i.view.wpmlcDeleteSelectedPermanentlyButton({filters:s,style:"primary",disabled:!0,text:r.deleteSelected,controller:this.controller,priority:-50}).render())}this.controller.isModeActive("grid")&&(this.toolbar.set("selectModeToggleButton",new i.view.SelectModeToggleButton({text:r.bulkSelect,controller:this.controller,priority:-70}).render()),this.toolbar.set("deleteSelectedButton",new i.view.DeleteSelectedButton({filters:s,style:"primary",disabled:!0,text:l?r.trashSelected:r.deleteSelected,controller:this.controller,priority:-60,click:function(){var i=[],o=[],s=this.controller.state().get("selection"),n=this.controller.state().get("library");s.length&&(l||window.confirm(r.warnBulkDelete))&&(l&&"trash"!==s.at(0).get("status")&&!window.confirm(r.warnBulkTrash)||(s.each(function(e){e.get("nonces").delete?l&&"trash"===e.get("status")?(e.set("status","inherit"),i.push(e.save()),o.push(e)):l?(e.set("status","trash"),i.push(e.save()),o.push(e)):e.destroy({wait:!0}):o.push(e)}),i.length?(s.remove(o),e.when.apply(null,i).then(t.bind(function(){n._requery(!0),this.controller.trigger("selection:action:done")},this))):this.controller.trigger("selection:action:done")))}}).render()),l&&this.toolbar.set("deleteSelectedPermanentlyButton",new wp.media.view.DeleteSelectedPermanentlyButton({filters:s,style:"primary",disabled:!0,text:r.deleteSelected,controller:this.controller,priority:-55,click:function(){var e=[],t=this.controller.state().get("selection");t.length&&window.confirm(r.warnBulkDelete)&&(t.each(function(t){t.get("nonces").delete?t.destroy({wait:!0}):e.push(t)}),this.controller.trigger("selection:action:done"))}}).render())),this.options.search&&(this.toolbar.set("searchLabel",new i.view.Label({value:r.searchMediaLabel,attributes:{for:"media-search-input"},priority:-30}).render()),this.toolbar.set("search",new i.view.Search({controller:this.controller,model:this.collection.props,attributes:{type:"search",value:r.searchMediaLabel,placeholder:r.searchMediaPlaceholder},priority:-30}).render())),this.options.dragInfo&&this.toolbar.set("dragInfo",new i.View({el:e('<div class="instructions">'+r.dragInfo+"</div>")[0],priority:-40}))},createSidebar:function(){o.AttachmentsBrowser.createSidebar.apply(this,arguments),this.controller.isModeActive("wpmlc-grid")&&this.toggleSidebar()},toggleSidebar:function(){this.controller.state().get("selection").length?(this.sidebar.$el.removeClass("hidden"),this.$el.children(".attachments").css("right","300px"),this.$el.children(".uploader-inline").css("right","310px")):(this.sidebar.$el.addClass("hidden"),this.$el.children(".attachments").css("right",0),this.$el.children(".uploader-inline").css("right","10px"))},createSingle:function(){if(o.AttachmentsBrowser.createSingle.apply(this,arguments),this.controller.isModeActive("wpmlc-grid")){var e=this.sidebar,t=this.options.selection.single();"trash"!==this.options.selection.at(0).get("status")&&e.set("details",new wp.media.view.wpmlcGridAttachmentDetails({controller:this.controller,model:t,priority:80})),this.toggleSidebar()}},disposeSingle:function(){o.AttachmentsBrowser.disposeSingle.apply(this,arguments),this.controller.isModeActive("wpmlc-grid")&&this.toggleSidebar()},updateContent:function(){var e,t=this;e=this.controller.isModeActive("grid")||this.controller.isModeActive("wpmlc-grid")?t.attachmentsNoResults:t.uploader,this.collection.length?(e.$el.addClass("hidden"),t.toolbar.get("spinner").hide()):(this.toolbar.get("spinner").show(),this.dfd=this.collection.more().done(function(){t.collection.length?e.$el.addClass("hidden"):e.$el.removeClass("hidden"),t.toolbar.get("spinner").hide()}))},createUploader:function(){this.uploader=new i.view.UploaderInline({controller:this.controller,status:!1,message:this.controller.isModeActive("grid")||this.controller.isModeActive("wpmlc-grid")?"":r.noItemsFound,canClose:this.controller.isModeActive("grid")||this.controller.isModeActive("wpmlc-grid")}),this.uploader.$el.addClass("hidden"),this.views.add(this.uploader)}}),o.MediaFrame={Post:{activate:i.view.MediaFrame.Post.prototype.activate}},t.extend(i.view.MediaFrame.Post.prototype,{activate:function(){var i=this.content.get();o.MediaFrame.Post.activate.apply(this,arguments),this.on("open",i.fixLayout,i),"undefined"!=typeof acf&&e(".acf-expand-details").length&&e(document).on("click",".acf-expand-details",t.debounce(t.bind(i.fixLayout,i),250))}}),e(document).ready(function(){e(document).on("mousedown",".media-frame .attachments-browser .attachments li",function(e){(e.ctrlKey||e.shiftKey)&&e.preventDefault()})}),e("body").addClass("wpmlc-media-css")}(jQuery,_);